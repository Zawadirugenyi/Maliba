if (self.CavalryLogger) { CavalryLogger.start_js(["PAVzyjJ"]); }

__d("LegacyMentionsInput.react",["cx","Bootloader","Event","FocusListener","Keys","ReactDOM","TypeaheadMetricsConfig","prop-types","react"],(function(a,b,c,d,e,f,g){var h;b("FocusListener");var i=h||(h=b("react"));a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.hasEnteredText=function(){return!!(d.$2&&d.$2.getValue().trim())},d.submitComment=function(a){var c;if(a)c=a.target.value&&a.target.value.trim();else{var e=b("ReactDOM").findDOMNode(d.refs.textarea);e.value&&e.value!==e.placeholder&&(c=e.value)}c=c||"";e={visibleValue:c,encodedValue:c};d.$2&&(e.encodedValue=d.$2.getRawValue().trim());e=d.props.onEnterSubmit(e,a);e&&d.$2&&(d.$2.reset(),a&&a.preventDefault())},d.$3=function(a){var c=a.nativeEvent;c=b("Event").getKeyCode(c)==b("Keys").RETURN&&!b("Event").$E(c).getModifiers().any;var e=d.$2&&d.$2.getTypeahead().getView().getSelection();d.props.onEnterSubmit&&c&&!e&&d.submitComment(a)},d.$4=function(){d.props.onFocus&&d.props.onFocus(),d.$1(b("ReactDOM").findDOMNode(d.refs.root))},d.$5=function(){d.props.onBlur&&d.props.onBlur()},d.$1=function(a){if(d.props.disableInitTextarea||d.$2||d.$6)return;d.$6=!0;b("Bootloader").loadModules(["CompactTypeaheadRenderer","ContextualTypeaheadView","InputSelection","MentionsInput","TextAreaControl","Typeahead","TypeaheadAreaCore","TypeaheadBestName","TypeaheadHoistFriends","TypeaheadMetrics","TypeaheadMetricsX","TypingDetector","UFIComments"],function(c,d,e,f,g,h,i,j,k,l,m,n,o){var p=this;o=b("ReactDOM").findDOMNode(this.refs.textarea);new g(o);if(this.props.onTypingStateChange){g=new n(o);g.init();g.subscribe("change",this.props.onTypingStateChange)}n={autoSelect:!0,renderer:c,causalElement:o,autoflip:this.props.autoflip};this.props.viewOptionsTypeObjects&&(n.typeObjects=this.props.viewOptionsTypeObjects);this.props.viewOptionsTypeObjectsOrder&&(n.typeObjectsOrder=this.props.viewOptionsTypeObjectsOrder);g=new h(this.props.datasource,{ctor:d,options:n},{ctor:i},b("ReactDOM").findDOMNode(this.refs.typeahead));c=[j,k];if(b("TypeaheadMetricsConfig").gkResults){d=new m({extraData:{event_name:"mention_metric_x"}});d.init(g)}n=new l({extraData:{event_name:"mentions",from_location:"comments"}});h.initNow(g,c,n);this.$2=new f(a,g,o,{hashtags:this.props.hashtags});this.$2.init({},this.props.initialData);this.props.initialData&&e.set(o,o.value.length);this.props.onPaste&&b("Event").listen(o,"paste",this.props.onPaste);this.props.onContentChange&&(this.$7=this.$2.subscribe("valueUpdate",function(a,b){a=b.value;p.props.onContentChange(a)}));this.$6=!1}.bind(babelHelpers.assertThisInitialized(d)),"LegacyMentionsInput.react")},d.focus=function(){try{b("ReactDOM").findDOMNode(d.refs.textarea).focus()}catch(a){}},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.componentDidMount=function(){this.props.initialData&&this.$1(b("ReactDOM").findDOMNode(this))};d.getText=function(){return this.$2&&this.$2.getRawValue().trim()};d.componentWillUnmount=function(){this.$2&&this.$7&&this.$2.unsubscribe(this.$7)};d.render=function(){var a="textInput mentionsTextarea uiTextareaAutogrow uiTextareaNoResize UFIAddCommentInput _2xww";return i.jsxs("div",{ref:"root",className:"uiMentionsInput textBoxContainer ReactLegacyMentionsInput _2xwx",children:[i.jsx("div",{className:"highlighter",children:i.jsx("div",{children:i.jsx("span",{className:"highlighterContent hidden_elem"})})}),i.jsx("div",{ref:"typeahead",className:"uiTypeahead mentionsTypeahead",children:i.jsxs("div",{className:"wrap",children:[i.jsx("input",{type:"hidden",autoComplete:"off",className:"hiddenInput"}),i.jsx("div",{className:"innerWrap",children:i.jsx("textarea",{ref:"textarea",name:"add_comment_text",className:a,title:this.props.placeholder,placeholder:this.props.placeholder,onFocus:this.$4,onBlur:this.$5,onKeyDown:this.$3})})]})}),i.jsx("input",{type:"hidden",autoComplete:"off",className:"mentionsHidden",defaultValue:""})]})};return c}(i.Component);a.propTypes={initialData:b("prop-types").object,disableInitTextarea:b("prop-types").bool,placeholder:b("prop-types").string,datasource:b("prop-types").object,ref:b("prop-types").string,viewOptionsTypeObjects:b("prop-types").object,viewOptionsTypeObjectsOrder:b("prop-types").array,hashtags:b("prop-types").bool,autoflip:b("prop-types").bool,onEnterSubmit:b("prop-types").func,onFocus:b("prop-types").func,onBlur:b("prop-types").func,onContentChange:b("prop-types").func,onTypingStateChange:b("prop-types").func,onPaste:b("prop-types").func};e.exports=a}),null);
__d("PhotoTagApproval",["Arbiter","CSS","DOM","Event","Parent","PhotosConst","ge"],(function(a,b,c,d,e,f){a=function(){"use strict";function a(a){this.viewer=a;this.units=[];this.currentUnit=0;var c=a.getVersionConst();c==b("PhotosConst").VIEWER_SNOWLIFT?this._root=b("ge")("fbPhotoSnowliftTagApproval"):this._root=b("ge")("fbPhotoPageTagApproval");b("Arbiter").subscribe(a.getEventString("DATA_CHANGE"),this.restartTagApproval.bind(this));b("Arbiter").subscribe("PhotoTagApproval.PENDING_TAG_PHOTO_CLICK",this.pendingTagPhotoClick.bind(this));b("Event").listen(this._root,"click",this.handleClick.bind(this));b("Event").listen(this._root,"mousemove",function(a){this.hiliteCurrentPendingTag(),b("Event").kill(a)}.bind(this));this.restartTagApproval()}var c=a.prototype;c.handleClick=function(a){a=a.getTarget();if(b("CSS").hasClass(a,"nextPager")&&b("CSS").hasClass(a,"enabled"))this.showNextUnit();else if(b("CSS").hasClass(a,"prevPager")&&b("CSS").hasClass(a,"enabled"))this.showPrevUnit();else if(b("Parent").byClass(a,"fbPhotoApprovalPendingButtons")){var c=this.units[this.currentUnit];c=this.getTagNameID(c);if(c){a=b("Parent").byClass(a,"approve");b("Arbiter").inform("PhotoTagApproval.UPDATE_TAG_BOX",{id:c,approve:a,version:this.viewer.getVersionConst()})}setTimeout(this.removeSelectedUnit.bind(this),0)}return!0};c.loadUnits=function(a){this.units=b("DOM").scry(this._root,"div.fbPhotoApprovalUnit"),this.units.length?(b("CSS").show(this._root),this.showUnit(a),b("CSS").conditionClass(this._root,"hidePagers",this.units.length==1)):(b("CSS").hide(this._root),b("Arbiter").inform("PhotoTagApproval.HILITE_TAG",{tag:null,version:this.viewer.getVersionConst()}))};c.restartTagApproval=function(){this.loadUnits(0)};c.pendingTagPhotoClick=function(a,c){if(c.version!==b("PhotosConst").VIEWER_PERMALINK&&c.version!==b("PhotosConst").VIEWER_SNOWLIFT)return!0;a="approve:"+c.id;for(var c=0;c<this.units.length;c++)if(this.units[c].id===a){this.showUnit(c);return!1}return!0};c.removeSelectedUnit=function(){var a=this.units[this.currentUnit];b("DOM").remove(a);this.loadUnits(this.currentUnit)};c.showNextUnit=function(){this.showUnit(this.currentUnit+1)};c.showPrevUnit=function(){this.showUnit(this.currentUnit-1)};c.getTagNameID=function(a){var b=a.id.indexOf(":");return a.id.slice(b+1)};c.showUnit=function(a){var c;this.units.forEach((c=b("CSS")).hide);this.currentUnit=(a+this.units.length)%this.units.length;a=this.units[this.currentUnit];c.show(a);this.hiliteCurrentPendingTag();c.conditionClass(b("DOM").find(this._root,"a.prevPager"),"enabled",this.currentUnit>0);c.conditionClass(b("DOM").find(this._root,"a.nextPager"),"enabled",this.currentUnit<this.units.length-1)};c.hiliteCurrentPendingTag=function(){var a=this.units[this.currentUnit];a=this.getTagNameID(a);b("Arbiter").inform("PhotoTagApproval.HILITE_TAG",{tag:a,version:this.viewer.getVersionConst()})};return a}();e.exports=a}),null);
__d("XFamilyBulkTagAddAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/family/bulk_tag_save/",{subject:{type:"Int"},save_tags:{type:"String"}})}),null);
__d("PhotoTagStore",["ActorURI","AsyncRequest","XFamilyBulkTagAddAsyncController","isEmpty"],(function(a,b,c,d,e,f){var g;a=function(){"use strict";function a(){this._tagList={},this._textTagList={},this._originalTagList={},this._dirtyPhotosByUid={},a.instance=this}var c=a.prototype;c.getPhotoTags=function(a){return this._tagList[a]||{}};c.photoHasTags=function(a){return!(g||(g=b("isEmpty")))(this.getPhotoTags(a))};c.clear=function(){this._tagList={},this._textTagList={},this._originalTagList={},this._dirtyPhotosByUid={}};c.addTag=function(a,b,c,d){a[b]=a[b]||{};var e=a[b][c]||[];e.push(d);a[b][c]=e};c.revert=function(a){var c=this._tagList,d=this._originalTagList;for(var e in c)(g||(g=b("isEmpty")))(d[e][a])?c[e][a]=[]:c[e][a]=d[e][a];this._dirtyPhotosByUid={}};c.hasNewTags=function(){return!(g||(g=b("isEmpty")))(this._tagList)||!(g||(g=b("isEmpty")))(this._textTagList)};c.userHasDirtyTags=function(a){return!(g||(g=b("isEmpty")))(this._dirtyPhotosByUid[a])};c.userDirtyTagsCount=function(a){return Object.keys(this._dirtyPhotosByUid[a]).length};c.handleTagFetch=function(a){for(var b in a)this.loadTagInfo(b,a[b])};c.saveAlbumTagsForUser=function(a,c,d,e){e===void 0&&(e=!1);var f={},h=[],i=this._dirtyPhotosByUid[a]||{};for(var j in i){i=this._tagList[j][a];if((g||(g=b("isEmpty")))(i)){h[h.length]=j;continue}i.forEach(function(a){f[j]={x:a.x,y:a.y}})}i={subject:a,action:"save",save_tags:f};h=b("ActorURI").create("/ajax/photos/album/tags.php",c);e&&(i={subject:a,save_tags:JSON.stringify(f)},h=b("XFamilyBulkTagAddAsyncController").getURIBuilder().getURI());new(b("AsyncRequest"))().setURI(h).setData(i).setHandler(function(a){d(a.payload)}).setAllowCrossPageTransition(!0).send();delete this._dirtyPhotosByUid[a]};c.getTagsFromList=function(a){var b=[];for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c))for(var d in a[c])Object.prototype.hasOwnProperty.call(a[c],d)&&a[c][d].forEach(function(a){return b.push(a)});return b};c.getAllTags=function(){var a=this.getTagsFromList(this._tagList),b=this.getTagsFromList(this._textTagList);return a.concat(b)};c.removeTag=function(a,c){var d=this._tagList[a],e=this._originalTagList[a]||{};e[c]?(this._dirtyPhotosByUid[c]=this._dirtyPhotosByUid[c]||{},this._dirtyPhotosByUid[c][a]=!0):delete this._dirtyPhotosByUid[c][a];for(var f in d)if(f==c){e=this._tagList[a][f];delete this._tagList[a][f];(g||(g=b("isEmpty")))(this._tagList[a])&&delete this._tagList[a];return e}};c.removeTextTag=function(a,c){var d=this._textTagList[a];if(!(g||(g=b("isEmpty")))(d[c])){d=this._textTagList[a][c];this._textTagList[a][c]=[];(g||(g=b("isEmpty")))(this._textTagList[a])&&delete this._textTagList[a];return d}return[]};c.removeAllNewTagsOfUser=function(a){var b=[];if(!this.userHasDirtyTags(a))return b;var c=this._dirtyPhotosByUid[a];for(var d in c)b=b.concat(this.removeTag(d,a));return b};c.removeAllTagsFromPhoto=function(a){var c=[];if(!(g||(g=b("isEmpty")))(this._tagList[a]))for(var d in this._tagList[a]){if(!Object.prototype.hasOwnProperty.call(this._tagList[a],d))continue;c=c.concat(this.removeTag(a,d))}if(!(g||(g=b("isEmpty")))(this._textTagList[a]))for(var e in this._textTagList[a]){if(!Object.prototype.hasOwnProperty.call(this._textTagList[a],e))continue;c=c.concat(this.removeTextTag(a,e))}return c};c.storeTag=function(a,b,c,d,e){this.storeTagWithOptions(a,b,c,d,{can_remove:e})};c.storeTagWithOptions=function(a,b,c,d,e){this._dirtyPhotosByUid[b]=this._dirtyPhotosByUid[b]||{};this._dirtyPhotosByUid[b][a]=!0;c={x:c,y:d};Object.assign(c,e);!b?this.addTag(this._textTagList,a,c.name,c):this.addTag(this._tagList,a,b,c)};c.loadTagInfo=function(a,b){this._tagList[a]={};this._originalTagList[a]={};for(var c=0;c<b.length;c++){var d=b[c];this.addTag(this._tagList,a,d.subject,d);this.addTag(this._originalTagList,a,d.subject,d)}};a.getInstance=function(){a.instance===null&&new a();return a.instance};return a}();a.instance=null;e.exports=a}),null);
__d("PhotosTaggingWaterfall",["AsyncSignal"],(function(a,b,c,d,e,f){function g(a){g._queueName=a||g._queueName}Object.assign(g,{BEGIN:"begin",TAG_FACE:"tag_face",HOVER_TAG_FACE:"hover_tag_face",SHOW_SUGGEST:"show_suggest",ADD_NAME:"add_name",TAG_CONFIRMED:"tag_confirmed",FINISH:"finish",TYPE_NAME:"type_name",SELECT_NAME:"select_name",_queueName:null,sendSignal:function(a,c){new(b("AsyncSignal"))("/ajax/photos/tag_waterfall.php",{data:JSON.stringify(a)}).setHandler(c).send()}});e.exports=g}),null);
__d("FaceboxSourceConstants",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({SNOWLIFT_SUGGEST:"snowlift_suggest",SNOWLIFT_DISMISS:"photo_snowlift_unit_suggestions",PERMALINK_SUGGEST:"permalink_suggest",PERMALINK_DISMISS:"photo_permalink_suggestions",UPLOADER_SUGGEST:"uploader_suggest",UPLOADER_DISMISS:"album_uploader_suggestions"})}),null);
__d("PhotoTagger",["csx","ActorURI","Arbiter","AsyncRequest","AsyncResponse","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Hovercard","Keys","LegacyMentionsInput.react","Parent","PhotoTagStore","PhotosConst","PhotosTaggingWaterfall","PhotosUtils","QE2Logger","ReactDOM","Style","UFIAddCommentController","UFICentralUpdates","UFIComment.react","UFIContainer.react","Vector","getElementPosition","react","removeFromArray"],(function(a,b,c,d,e,f,g){var h,i=h||b("react");function j(a,b){return(a%b+b)%b}a=function(){"use strict";function a(b){this.TAG_BOX_SIZE=100,this.EPSILON=.0025,this.HUGE_FACE_THRESH=90,this.HUGE_FACE_SHRINK_FACTOR=.6,this.elemNames={6:{addTagLink:"div.fbPhotosPhotoOwnerButtons",overlayActions:"div.snowliftOverlayBar"}},this.viewer=b,this.version=b.getVersionConst(),this.isPhotoEditor=!1,this.datasources={},this.photoData={},this.tagRects={},this.spatialTags=[],this.isSpherical=!1,this.sphericalPhotoXY=null,this.fromSphericalFacebox=!1,this.disableSaveSpatialTag=!1,this.ajaxURIs={tagsInit:"/ajax/photos/photo/tags/tags_init.php",tagsAlbum:"/ajax/photos/photo/tags/tags_album.php",fetchDatasource:"/ajax/photos/photo/tags/fetch_datasource.php",tagAction:"/ajax/photo_tagging_ajax.php",tagWithAction:"/ajax/with_tagging_ajax.php"},this.recognizedUsers=[],this.addedSuggestions=[],this.featuredSuggestions=[],this.albumSuggestions=[],this.friendSuggestions=[],this.suggestionAlbum=-1,this.addCommentController=null,this.isFirstBackspace=!0,this.previousQueryString="",a.instances[this.version]=this}var c=a.prototype;c.initSnowlift=function(a,c,d,e){this._init(a,c,d,this.viewer.container,e),b("Arbiter").inform("PhotoSnowlift.TAGGER_READY")};c.initPermalink=function(a,b,c){this._init(a,b,c,this.viewer.actionList)};c.initSphericalPhoto=function(a,c,d){this._init(a,c,d,this.viewer.container),b("Arbiter").inform("PhotoTagger.SPATIAL_TAGGER_READY")};c._init=function(a,c,d,e,f){this.root=this.viewer.getRoot();this.tagger=a;this.tokenizer=c;this.ufi=f;this._qn=null;this.typeahead=c.getTypeahead();this.userId=d;this.makeProfilePicMenuContainer=e;this.faceboxes=[];this.tags=[];this.currentFacebox=null;this.currentTextbox=null;this.revokedFaceboxes=[];this.requestFaceboxNextTag=!1;this.clickState=b("DOM").find(this.root,"div.stageActions");this.newTagBox=b("DOM").scry(this.clickState,"div.newTagBox")[0];this.addTagLink=null;this.overlayActions=null;this.elemNames[this.version]&&(this.addTagLink=b("DOM").find(this.root,this.elemNames[this.version].addTagLink),this.overlayActions=b("DOM").find(this.root,this.elemNames[this.version].overlayActions));this.setupHandlers();this.hideNewTagTimer=null;this.needAlbumSuggestionsFetch=!0;this.fetchTaggingSuggestions({owner:this.photoData.owner});this.setDataSource(this.typeahead.getData());this.updateFaceboxes();this.tagAccumulating=!1;return this};c.setTagAccumulator=function(a){this.tagAccumulating=a};c.fetchTaggingSuggestions=function(a){new(b("AsyncRequest"))().setAllowCrossPageTransition(!0).setAllowCrossOrigin(!0).setURI(this.ajaxURIs.tagsInit).setData(a).setOption("retries",1).setHandler(function(a){a=a.getPayload();this.featuredSuggestions=a.featuredTaggees;this.friendSuggestions=a.friendTaggees;this.updateTypeaheadSuggestions()}.bind(this)).send();var c=this.typeahead.subscribe("bootstrap",function(a,b){b&&!b.bootstrapping&&(this.taggingMode&&this.updateWithSuggestions(),this.typeahead.unsubscribe(c),this.typeahead.subscribe("focus",function(){this.taggingMode&&this.updateWithSuggestions()}.bind(this)),this.typeahead.subscribe("click",function(){this.taggingMode||this.updateWithSuggestions()}.bind(this)),this.tokenizer.subscribe("removeToken",this.updateWithSuggestions.bind(this)),this.tokenizer.subscribe("addToken",this.addSuggestion.bind(this)),this.typeahead.subscribe("respond",function(a,b){this.taggingMode&&b&&!b.results.length&&this.updateWithSuggestions()}.bind(this)))}.bind(this))};c.fetchAlbumTaggingSuggestions=function(){new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagsAlbum).setData({cachedAlbum:this.suggestionAlbum,photo:this.photoData.fbid}).setOption("retries",1).setAllowCrossPageTransition(!0).setHandler(function(a){this.needAlbumSuggestionsFetch=!1;a=a.getPayload();if(a.length===0)return;this.suggestionAlbum=a.album;this.albumSuggestions=a.taggees;this.updateTypeaheadSuggestions()}.bind(this)).send()};c.resetAlbumTaggingSuggestions=function(){this.needAlbumSuggestionsFetch=!0,this.updateTypeaheadSuggestions()};c.updateTypeaheadSuggestions=function(){this.typeahead.getView().setSuggestions(this.addedSuggestions.concat(this.recognizedUsers,this.featuredSuggestions,this.needAlbumSuggestionsFetch?[]:this.albumSuggestions,this.friendSuggestions))};c.saveClickPosition=function(a,c){var d=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);this.clickPercentToPhoto=new(b("Vector"))((c.x-d.x)/a.x,(c.y-d.y)/a.y)};c.getCalculatedClickPosition=function(a){var c=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);return a.x===0||a.y===0?null:new(b("Vector"))(this.clickPercentToPhoto.x*a.x+c.x,this.clickPercentToPhoto.y*a.y+c.y,"document")};c.repositionTagger=function(){if(this.clickPercentToPhoto){var a=this.viewer.getImage();a=this.getCalculatedClickPosition(a);if(!a)return;this.addTagFromClickPos(a)}};c._setIsFirstBackspace=function(a){this.isFirstBackspace=a};c.setupHandlers=function(){var a=this;this.handlers=[b("Event").listen(this.clickState,"click",function(b){a.isSpherical||a.addTag(b)})];this.addTagLink&&this.handlers.push(b("Event").listen(this.addTagLink,"click",this.checkActions.bind(this)));this.overlayActions&&this.handlers.push(b("Event").listen(this.overlayActions,"click",this.checkActions.bind(this)));this.setupAddTagHandlers();b("Event").listen(document.documentElement,"keydown",function(a){if(!this.taggingMode)return;var c=b("Event").getKeyCode(a);c===b("Keys").TAB&&this.addNextTagFromFacebox(a.shiftKey?-1:1)}.bind(this));this.subscriptions=[b("Arbiter").subscribe(this.viewer.getEventString("PAGE"),this.restartTagging.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("DATA_CHANGE"),this.setPhotoData.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("EXTRA_DATA_CHANGE"),this.setExtraData.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("CLOSE"),this.deactivateTagging.bind(this))];b("UFICentralUpdates").subscribe("update-comments",function(a,b){b.comments&&b.comments.length&&this.commentAdded(b.comments,b.payloadsource)}.bind(this));this.tokenizer.subscribe("addToken",this.saveTag.bind(this));this.tokenizer.subscribe("removeToken",this.removeTag.bind(this));this.tokenizer.subscribe("markTagAsSpam",this.markTagAsSpam.bind(this))};c.setupAddTagHandlers=function(){if(this.ufi){var a=b("DOM").scry(this.root,".tagPhotoLink");a.forEach(function(a){b("Event").listen(a,"click",this.showTaggerFromClick.bind(this))},this)}};c.updateWithSuggestions=function(a,b){a=this.typeahead.getData().buildUids(" ",this.typeahead.getView().getSuggestions(),this.typeahead.getCore().getExclusions());if(!a.length)return;b=this.typeahead.getData().respond("",a);for(var a=0;a<b.length;a++)b[a].index=-1e3+a};c.addSuggestion=function(a,b){a=b.info&&b.info.uid;a&&(this.addedSuggestions.unshift(a),this.updateTypeaheadSuggestions())};c.setQueueName=function(a){this._qn=a;return this};c._sendWaterfallLogSignal=function(a){b("PhotosTaggingWaterfall").sendSignal({qn:this._qn,source:this.viewer.getSourceString(),step:a,pid:this.photoData.pid})};c._sendFaceboxSuggestionLogSignal=function(a,c,d){b("PhotosTaggingWaterfall").sendSignal({step:b("PhotosTaggingWaterfall").SHOW_SUGGEST,photo_owner:this.photoData.owner,tagee:a,is_first:!0,source:c,photo_id:this.photoData.fbid,facebox_id:d})};c._bumpQueueName=function(){this._qn&&(this._qn+=1)};c.activateTagging=function(){b("Arbiter").inform("PhotoTagger.ACTIVATE_TAGGING"),this.getDataSource()?this.dataSourceFetched(this.getDataSource()):new(b("AsyncRequest"))(this.ajaxURIs.fetchDatasource).setData({fbid:this.photoData.fbid,version:this.version,data_source_type:this.dataSourceType}).send(),this.needAlbumSuggestionsFetch&&this.fetchAlbumTaggingSuggestions()};c.restartTagging=function(){this.hideNewTag(),this.hideTagger(),this.hideExistingTags(),this.revokedFaceboxes=[],this.setCurrentFacebox(null),this.taggingMode&&(this.requestFaceboxNextTag=!0,this.activateTagging())};c.getDataSource=function(){return this.datasources[this.getDataSourceKey()]};c.getDataSourceKey=function(){var a;this.photoData.ownertype=="user"&&!this.photoData.obj_id?a="friends":a=this.photoData.obj_id||this.photoData.owner;return a};c.setDataSource=function(a){this.typeahead.getData()!=a&&this.typeahead.swapData(a),this.datasources[this.getDataSourceKey()]=a};c.dataSourceFetched=function(a){b("CSS").removeClass(this.root,"peopleTagging"),this.taggingMode=!0,b("CSS").addClass(this.root,"taggingMode"),this.dataSourceType&&(this.dataSourceType==="default",b("CSS").addClass(this.root,"peopleTagging")),this._hidePivots(),b("Arbiter").inform("PhotoTagger.START_TAGGING"),this._bumpQueueName(),this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").BEGIN),this.setDataSource(a)};c.deactivateTagging=function(){this.taggingMode===!0&&this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").FINISH),this.taggingMode=!1,this.hideNewTag(),this.hideTagger(),this.hideExistingTags(),this.setCurrentFacebox(null),this._showPivots(),b("CSS").removeClass(this.root,"taggingMode"),b("CSS").removeClass(this.root,"peopleTagging"),b("Arbiter").inform("PhotoTagger.STOP_TAGGING")};c._hidePivots=function(){var a=b("DOMQuery").scry(this.root,".tag");for(var c=0;c<a.length;c++)b("CSS").hide(a[c])};c._showPivots=function(){var a=b("DOMQuery").scry(this.root,".tag");for(var c=0;c<a.length;c++)b("CSS").show(a[c])};c.checkActions=function(a){a=a.getTarget();a=b("Parent").byClass(a,"fbPhotosPhotoActionsTag");if(a){a=b("CSS").hasClass(this.root,"peopleTagging");a=a;this.taggingMode&&!a?this.deactivateTagging():(this.dataSourceType="default",this.activateTagging(),this.isSpherical||this.addNextTagFromFacebox(1))}};c.hideTagger=function(){b("CSS").hide(this.tagger);this.clickPercentToPhoto=null;var a=b("DOM").scry(this.tagger,"input.textInput")[0];a&&a.blur()};c.showTaggerFromClick=function(a){a=a.getTarget();a=b("Parent").byClass(a,"tagPhotoLink");var c=a.getAttribute("data-x");a=a.getAttribute("data-y");if(c!==null&&a!==null){c=new(b("Vector"))(c,a);a=this.viewer.getImage();c=b("PhotosUtils").normalizedToAbsolutePosition(a,c);this.setClickPosAndFacebox(c);this.addTagFromClickPos(c)}this.showTagger()};c.showTagger=function(){b("QE2Logger").logExposureForUser("www_snowlift_photo_tagger_qe");b("DOM").scry(this.root,".fbPhotosPhotoTagboxBase").forEach(function(a){b("CSS").removeClass(a,"hover"),b("CSS").removeClass(a,"tagClick"),this.taggingMode&&b("CSS").hide(b("DOM").find(a,".tag"))},this);var a=b("DOM").find(this.tagger,".typeaheadContainer"),c=b("DOM").find(a,".arrow .nub"),d=3;b("Style").set(a,"margin-left",0);b("Style").set(c,"margin-left",0);var e=b("getElementPosition")(a);e.x<=0&&(b("CSS").hasClass(this.tagger,"fbPhotoTaggerFlipped")||(b("Style").set(a,"margin-left",-2*e.x+"px"),b("Style").set(c,"margin-left",e.x-d+"px")));if(this.ufi){c=b("DOM").find(this.tagger,"._12nb");b("CSS").show(a);b("CSS").hide(c)}b("CSS").show(this.tagger);window.setTimeout(function(){b("DOM").find(this.tagger,"input.textInput").focus()}.bind(this),0);this.hideNewTag();b("Arbiter").inform("reflow")};c.showNewTag=function(a,c){if(c&&this.ufi){b("CSS").addClass(c,"hover");b("DOM").find(c,".uiLinkButtonInput").value=a;return}if(!this.newTagBox)return;b("DOM").setContent(b("DOM").find(this.newTagBox,"div.tagName"),b("DOM").create("span",null,a));b("CSS").show(this.newTagBox);this.hideNewTagTimer=window.setTimeout(this.hideNewTag.bind(this),3e3)};c.hideNewTag=function(){if(!this.newTagBox)return;this.hideNewTagTimer!==null&&(window.clearTimeout(this.hideNewTagTimer),this.hideNewTagTimer=null);b("CSS").hide(this.newTagBox)};c.getTaggerPositioningOrigin=function(){return b("Vector").getElementPosition(this.clickState,"document")};c.setClickPosAndFacebox=function(a){var c=this.viewer.getImage();this.saveClickPosition(c,a);c=b("PhotosUtils").absoluteToNormalizedPosition(c,a);this.setCurrentFacebox(this.findNearestFacebox(c))};c.addTagFromClickPos=function(a){this.currentTextbox=null;this.hideExistingTags();if(this.currentFacebox)this.addTagFromFaceboxDontSave(this.currentFacebox);else{var c=this.viewer.getImage(),d=b("PhotosUtils").absoluteToNormalizedPosition(c,a);if(this.tags!==void 0)for(var e=0;e<this.tags.length;e++)this.tags[e].rect.contains(d)&&(this.showExistingTag(this.tags[e]),this.currentTextbox=this.tags[e]);this.removeSuggestionFromTagger();b("CSS").removeClass(b("DOM").find(this.tagger,".faceBox"),"faceBoxHidden");if(this.currentTextbox){e=this.currentTextbox.rect.w()/100*b("Vector").getElementDimensions(c).x;this.addTagFromPosition(a,e)}else this.addTagFromPosition(a,this.TAG_BOX_SIZE)}};c.showExistingTag=function(a){this.taggingMode?(this._hidePivots(),b("CSS").show(b("DOM").find(a.node,".tag")),b("CSS").addClass(a.node,"tagClick")):b("CSS").addClass(a.node,"hover"),this.hideTagger()};c.hideExistingTags=function(){var a=this,c=b("DOM").scry(this.root,".tagClick");c&&c.forEach(function(c){b("CSS").removeClass(c,"tagClick"),a.taggingMode&&b("CSS").hide(b("DOM").find(c,".tag"))})};c.addTag=function(a){var c=a.getTarget(),d=b("Parent").byClass(c,"fbPhotosPhotoButtons");if(!this.taggingMode||d&&c!==d||b("Parent").byClass(c,"fbPhotosPhotoActions")||b("Parent").byClass(c,"faceboxSuggestion")||b("Parent").byClass(c,"photoTagTypeahead")||b("Parent").byClass(c,"tagUfi"))return;d=b("Vector").getEventPosition(a);this.setClickPosAndFacebox(d);this.addTagFromClickPos(d)};c.addSpatialTag=function(a,c){c=c.getTarget();var d=b("Parent").byClass(c,"fbPhotosPhotoButtons"),e=a.inTaggingMode?this.viewer.stageActions:this.viewer.stage;if(d&&c!==d||b("Parent").byClass(c,"fbPhotosPhotoActions")||b("Parent").byClass(c,"faceboxSuggestion")||b("Parent").byClass(c,"photoTagTypeahead")||b("Parent").byClass(c,"tagUfi")||!a.screenPos||!a.photoXY||!a.size||!this.isSpherical||!e)return;this.sphericalPhotoXY=a.photoXY;this.fromSphericalFacebox=a.fromTag;d=b("getElementPosition")(e);this.fromSphericalFacebox&&!!a.suggestion?this.addTagFromFaceboxDontSave(a.suggestion):this.removeSuggestionFromTagger();this.addTagFromPosition(b("Vector").from(a.screenPos.x+d.x,a.screenPos.y+d.y,"document"),a.size);c=b("DOM").find(this.tagger,".faceBox");this.fromSphericalFacebox&&!b("CSS").hasClass(c,"faceBoxHidden")&&b("CSS").addClass(c,"faceBoxHidden");!this.fromSphericalFacebox&&b("CSS").hasClass(c,"faceBoxHidden")&&b("CSS").removeClass(c,"faceBoxHidden")};c.showTagIfCommentAdded=function(){if(this.taggingMode){var a=this.getClickPointForSave(),c=b("Vector").from(a.x,a.y);if(a!==null)for(var a=0;a<this.tags.length;a++)if(this.tags[a].rect.contains(c)){this.showExistingTag(this.tags[a]);this.hideTagger();return}}};c.commentAdded=function(a,c){a.forEach(function(a){var c=this.getClickPointForSave(),d=null;if(a.isPhotoTag&&(a.photoTextTagID===null||a.photoTextTagID===void 0)&&a.photoTagX!==null&&a.photoTagY!==null)if(c!==null&&a.photoTagX===c.x&&a.photoTagY===c.y)d=b("DOM").find(this.tagger,"._12nb");else{c=new(b("Vector"))(a.photoTagX,a.photoTagY);c=this.findNearestTag(c);c!==null&&(d=b("DOM").find(c.node,"._12nb"))}if(d!==null){c=b("DOM").find(d,".UFIContainer");var e={};e[a.author]={id:a.author};b("ReactDOM").render(i.jsx(b("UFIContainer.react"),{children:i.jsx(b("UFIComment.react"),{comment:a,authorProfiles:e,feedback:{},contextArgs:{}})}),c);b("Style").set(b("DOM").find(d,".UFIAddComment"),"opacity",.5);b("DOM").find(d,"textarea").setAttribute("disabled","disabled")}},this)};c.showTaggerUFI=function(a){a=b("DOM").find(this.tagger,".typeaheadContainer");var c=b("DOM").find(this.tagger,"._12nb"),d=b("DOM").find(c,".arrow .nub"),e=3,f=b("getElementPosition")(c);f.x<=0&&!b("CSS").hasClass(this.tagger,"fbPhotoTaggerFlipped")?(b("Style").set(c,"margin-left",-2*f.x+"px"),b("Style").set(d,"margin-left",f.x-e+"px")):(b("Style").set(c,"margin-left",0),b("Style").set(d,"margin-left",0));f=this.getClickPointForSave();e=b("DOM").find(c,".tagUfiAddComment");d=b("DOM").find(this.viewer.ufiInputContainer,'input[name="ft_ent_identifier"]');d={ftentidentifier:d.value,source:e.getAttribute("data-source"),mentionsinput:{inputComponent:b("LegacyMentionsInput.react")},hideActorPhoto:!0,isPhotoTag:!0,photoFBID:this.viewer.getCurrentPhotoInfo().fbid,photoTagX:f.x,photoTagY:f.y};this.addCommentController=b("UFIAddCommentController").factory(e,d);f=b("DOM").find(c,".UFIContainer");f.firstChild!==null&&b("DOM").remove(f.firstChild);b("Style").set(b("DOM").find(c,".UFIAddComment"),"opacity",1);b("DOM").find(c,"textarea").removeAttribute("disabled");b("CSS").show(this.tagger);b("CSS").hide(a);b("CSS").show(c);b("Arbiter").inform("reflow")};c._findNearest=function(a,b){var c=Infinity,d=null;a.forEach(function(a){if(a.rect.contains(b)){var e=b.distanceTo(a.rect.getCenter());e<c&&(c=e,d=a)}});return d};c.findNearestFacebox=function(a){return this._findNearest(this.faceboxes,a)};c.findNearestTag=function(a){return this._findNearest(this.tags,a)};c.addNextTagFromFacebox=function(a){if(this.faceboxes.length===0)return;if(!this.currentFacebox)this.setCurrentFacebox(this.faceboxes[0]);else{var b=this.faceboxes.indexOf(this.currentFacebox);a=j(b+a,this.faceboxes.length);if(a===b)return;this.setCurrentFacebox(this.faceboxes[a])}this.addTagFromFacebox(this.currentFacebox)};c.addTagFromFaceboxDontSave=function(a){b("CSS").addClass(a.node,"active");b("CSS").addClass(b("DOM").find(this.tagger,".faceBox"),"faceBoxHidden");var c=a.rect.getCenter(),d=this.viewer.getImage();c=b("PhotosUtils").normalizedToAbsolutePosition(d,c);d=a.rect.w()/100*b("Vector").getElementDimensions(d).x;a.rect.w()>this.HUGE_FACE_THRESH&&a.rect.h()>this.HUGE_FACE_THRESH&&(d*=this.HUGE_FACE_SHRINK_FACTOR);var e=this.getFaceboxSuggestionFromFaceboxElem(a.node);if(e){var f=this.version===b("PhotosConst").VIEWER_PERMALINK?b("FaceboxSourceConstants").PERMALINK_DISMISS:b("FaceboxSourceConstants").SNOWLIFT_DISMISS;this.addSuggestionToTagger(a,e);this._sendFaceboxSuggestionLogSignal(e.getAttribute("data-id"),f,a.id)}else this.removeSuggestionFromTagger();this.isSpherical||this.addTagFromPosition(c,d);return c};c.getFaceboxSuggestionFromFaceboxElem=function(a){return b("DOM").scry(a,"._570u")[0]};c.addSuggestionToTagger=function(a,c){this.removeSuggestionFromTagger();b("CSS").addClass(this.tagger,"suggestionActive");var d=b("DOM").find(this.tagger,".typeaheadContainer");c=c.cloneNode(!0);this.stripReactID(c);b("DOM").appendContent(d,c);this.setupFaceboxSuggestionHandlers(a,c)};c.stripReactID=function(a){a.removeAttribute("data-reactid");for(var b=0;b<a.children.length;b++)this.stripReactID(a.children[b])};c.removeSuggestionFromTagger=function(){b("CSS").removeClass(this.tagger,"suggestionActive");var a=b("DOM").scry(this.tagger,".faceboxSuggestion");a&&a.forEach(function(a){b("DOM").remove(a)})};c.dismissFaceboxSuggestion=function(a,c,d,e){new(b("AsyncRequest"))().setURI("/ajax/dismiss_tag_suggest.php").setMethod("POST").setData({facebox_logs:[{facebox:a,log_data:{photo_owner:d,tagee:c,is_first:!0}}],closing_source:e,closing_action:"no"}).setAllowCrossPageTransition(!0).send()};c.addTagFromFacebox=function(a){this.currentTextbox=null;a=this.addTagFromFaceboxDontSave(a);var b=this.viewer.getImage();this.saveClickPosition(b,a)};c.addTagFromPosition=function(a,c){var d=this.viewer.getImage(),e=this.calcTaggerPosition(d,a,c);this.calcClickPoint(d,a);if(!e){this.hideTagger();return}e.setElementPosition(this.tagger);this.newTagBox&&(e.setElementPosition(this.newTagBox),new(b("Vector"))(c,c).setElementDimensions(this.newTagBox));e=b("Vector").getElementPosition(d);c=b("Vector").getElementDimensions(d);d=this.typeahead.getView();var f=3/4;a.y>e.y+c.y*f?(b("CSS").addClass(this.tagger,"fbPhotoTaggerFlipped"),d.addTypeaheadFlip("fbPhotoTaggerFlipped"),a.x>e.x+c.x*1/2?this.flipRules("fbPhotoTaggerRight","fbPhotoTaggerLeft",d):this.flipRules("fbPhotoTaggerLeft","fbPhotoTaggerRight",d)):(b("CSS").removeClass(this.tagger,"fbPhotoTaggerFlipped"),b("CSS").removeClass(this.tagger,"fbPhotoTaggerLeft"),b("CSS").removeClass(this.tagger,"fbPhotoTaggerRight"),d.removeTypeaheadFlip("fbPhotoTaggerFlipped"),d.removeTypeaheadFlip("fbPhotoTaggerLeft"),d.removeTypeaheadFlip("fbPhotoTaggerRight"));(!this.taggingMode||this.currentTextbox===null)&&this.ufi&&this.currentFacebox===null?this.showTaggerUFI():this.showTagger();this.taggingMode?this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").TAG_FACE):this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").HOVER_TAG_FACE)};c.flipRules=function(a,c,d){b("CSS").addClass(this.tagger,a),b("CSS").removeClass(this.tagger,c),d.addTypeaheadFlip(a),d.removeTypeaheadFlip(c)};c.calcTaggerPosition=function(a,c,d,e){e=e||d;var f=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);var g=new(b("Vector"))(d/2,e/2),h=c.sub(f);for(var i in{x:1,y:1}){if(c[i]<f[i]||c[i]>f[i]+a[i])return null;var j=i==="x"?d:e;h[i]<j/2?g[i]=h[i]:a[i]<h[i]+j/2&&(g[i]=j-(a[i]-h[i]))}j=3;a=b("DOM").find(this.tagger,".faceBox");f=Math.max(0,d-j*2);h=Math.max(0,e-j*2);b("Style").set(a,"width",f+"px");b("Style").set(a,"height",h+"px");d=c.sub(this.getTaggerPositioningOrigin());return d.sub(g.x,g.y)};c.calcClickPoint=function(a,c){var d=b("Vector").getElementDimensions(a);a=b("Vector").getElementPosition(a);c=c.sub(a);!this.isSpherical?this.clickPoint={x:c.x/d.x,y:c.y/d.y}:this.clickPoint={x:this.sphericalPhotoXY.x,y:this.sphericalPhotoXY.y}};c.getClickPointForSave=function(){return this.clickPoint===void 0?null:{x:this.clickPoint.x*100,y:this.clickPoint.y*100}};c.getTaggingDataForSave=function(a,b){a=this.getTaggingData("add",a.isFreeform()?"":a.getValue(),a.getText(),b);b=this.getClickPointForSave();a.x=b.x;a.y=b.y;a.from_facebox=this.isSpherical?this.fromSphericalFacebox:!!this.currentFacebox;a.tagging_mode=!!this.taggingMode;return a};c.saveTag=function(a,c,d){if(this.disableSaveSpatialTag&&this.isSpherical&&this.tagAccumulating)return;a=this.getTaggingDataForSave(c,d);if(this.tagAccumulating)this.isSpherical?b("Arbiter").inform("PhotoTagger.SAVE_SPATIAL_TAG",a):b("PhotoTagStore").getInstance().storeTagWithOptions(this.photoData.fbid,a.subject,a.x,a.y,a);else{this.isSpherical&&b("Arbiter").inform("PhotoTagger.SAVE_SPATIAL_TAG");d=b("ActorURI").create(this.ajaxURIs.tagAction,this.viewer.actorID);new(b("AsyncRequest"))().setURI(d).setMethod("POST").setData(a).setAllowCrossPageTransition(!0).setHandler(this.tagsChangeHandler.bind(this)).setErrorHandler(this.checkError.bind(this,c)).send()}d=this.userId===a.subject;if(d&&!this.isSpherical){var e=b("DOM").scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(e.length===1){e=e[0];b("CSS").removeClass(e,"hide")}}if(!this.isSpherical){e=new(b("Vector"))(a.x,a.y);var f=this.findNearestTag(e);f&&f.rect.contains(e)?this.showNewTag(c.getText(),f.node):this.showNewTag(c.getText())}this.hideTagger();if(!this.isSpherical){e=this.currentFacebox;e&&(this.taggingMode&&this.addNextTagFromFacebox(1),this.removeFacebox(e))}b("Arbiter").inform("PhotoTagger.ADDING_TAG",{subject:a.subject,text:c.getText()});b("Arbiter").inform("PhotoTagger.SAVE_TAG",{photo_fbid:this.photoData.fbid,self_tag:d})};c.getTaggingData=function(a,b,c,d){return{cs_ver:this.version,pid:this.photoData.pid,fbid:this.photoData.fbid,id:this.photoData.owner,subject:b,name:c,action:a,source:d?d:this.viewer.getSourceString(),qn:this._qn,position:this.getPosition(),slsource:this.viewer.getViewerSource(),slset:this.viewer.getViewerSet()}};c.getPosition=function(){return this.viewer.getPosition()};c.tagsChangeHandler=function(a){};c.checkError=function(a,c){c.getPayload()&&c.getPayload().clear_tag&&(a.already_untagged=!0,this.tokenizer.removeToken(a)),b("AsyncResponse").defaultErrorHandler(c)};c.removeTag=function(a,c,d){if(c.already_untagged||this.tagAccumulating&&this.isSpherical)return;a="remove";b("DOM").scry(c.element,"a.pending")[0]&&(a="retract");c.blockUser&&(a="remove_block");this.tagAccumulating?c.isFreeform()?b("PhotoTagStore").getInstance().removeTextTag(this.photoData.fbid,c.getInfo().text):b("PhotoTagStore").getInstance().removeTag(this.photoData.fbid,c.getInfo().uid):new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagAction).setMethod("POST").setData(this.getTaggingData(a,c.isFreeform()?"":c.getInfo().uid,c.getInfo().text)).setHandler(function(a){this.tagsChangeHandler(a),d&&d()}.bind(this)).setAllowCrossPageTransition(!0).send();if(this.userId===parseInt(c.getValue(),10)&&this.userId!==this.viewer.getCurrentPhotoInfo().owner){a=b("DOM").scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(a.length===1){c=a[0];b("CSS").addClass(c,"hide")}b("Arbiter").inform("PhotoTagger.REMOVED_MAKE_PROFILE_PIC_OPTION")}};c.removeTagByID=function(a,b,c){a=this.tokenizer.tokens;for(var d=0;d<a.length;d++)if(a[d].info.uid==b)return this.removeTag(null,a[d],c);return null};c.removeTagByIDFromHovercardLink=function(a,c,d){this.removeTagByID(a,c,function(){b("Hovercard").contains(d)&&b("Hovercard").hide(!0)})};c.removeWithTag=function(a,c){new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagWithAction).setMethod("POST").setData({action:"remove_with",taggee:c,tag:a,version:this.version,fbid:this.photoData.fbid}).setHandler(function(a){this.tagsChangeHandler(a),b("Hovercard").hide(!0)}.bind(this)).setAllowCrossPageTransition(!0).send()};c.setPhotoData=function(a,b){this.clickPercentToPhoto=null;this.photoData=b;this.isSpherical=b.isSpherical;return this};c.setExtraData=function(a,b){var c=this;this.tagRects=b.tagRects;b.spatialTags&&(this.spatialTags=b.spatialTags);this.updateFaceboxes();this.setupAddTagHandlers();this._setInitialFaceboxFromID(b);b.openTag&&window.setTimeout(function(){c.activateTagging(),c._setInitialFaceboxFromID(b),c.faceboxes.length===1?c.addTagFromFacebox(c.currentFacebox):c.addNextTagFromFacebox(1)},0);return this};c._setInitialFaceboxFromID=function(a){if(a.initialFaceboxID!==null&&this.faceboxes.length!==0){a=this.getFacebox(a.initialFaceboxID);if(a!==null){a=this.faceboxes.indexOf(a);a=j(a-1,this.faceboxes.length);this.setCurrentFacebox(this.faceboxes[a])}}};c.markTagAsSpam=function(a,c){new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagAction).setMethod("POST").setData(this.getTaggingData("mark_as_spam",c,null)).send()};c.removeFacebox=function(a){if(a===null)return;this.revokedFaceboxes.push(a.rect.getCenter());b("removeFromArray")(this.faceboxes,a);b("DOM").remove(a.node);a===this.currentFacebox&&this.setCurrentFacebox(null)};c.setCurrentFacebox=function(a){this.currentFacebox&&b("CSS").removeClass(this.currentFacebox.node,"active"),this.currentFacebox=a,a&&(this.recognizedUsers=JSON.parse(a.node.getAttribute("data-recognizeduids")),this.updateTypeaheadSuggestions())};c.updateRevokedFaceboxes=function(){var a=this;this.revokedFaceboxes=this.revokedFaceboxes.filter(function(b){for(var c=0;c<a.faceboxes.length;++c){var d=a.faceboxes[c];d=b.distanceTo(d.rect.getCenter());if(d<a.EPSILON)return!0}return!1});this.revokedFaceboxes.forEach(function(c){c=a.findNearestFacebox(c);b("removeFromArray")(a.faceboxes,c);b("DOM").remove(c.node)})};c.updateFaceboxes=function(){this.faceboxes=[];this.tags=[];for(var a in this.tagRects){var c;b("PhotosUtils").isFacebox(a)?c=this.faceboxes:b("PhotosUtils").isTag(a)&&(c=this.tags);if(c){var d="container";this.version===b("PhotosConst").VIEWER_PERMALINK&&(d="root");d=b("DOM").scry(this.viewer[d],"#"+a);d.length>0&&c.push({node:d[0],id:a,rect:this.tagRects[a]})}this.showTagIfCommentAdded()}this.updateRevokedFaceboxes();this.faceboxes.sort(function(a,b){return a.rect.getCenter().x-b.rect.getCenter().x});if(this.currentFacebox){d=this.currentFacebox.rect.getCenter();this.setCurrentFacebox(this.findNearestFacebox(d));b("CSS").addClass(this.currentFacebox.node,"active")}this.requestFaceboxNextTag&&(this.addNextTagFromFacebox(1),this.requestFaceboxNextTag=!1)};c.getFacebox=function(a){for(var b=0;b<this.faceboxes.length;++b)if(this.faceboxes[b].id===a)return this.faceboxes[b];return null};c.setupFaceboxSuggestionHandlers=function(a,c){var d=b("DOM").find(c,"a._570w"),e=b("DOM").find(c,"a._570x");this.handlers.push(b("Event").listen(d,"click",function(d){d=this._getCurrentFaceboxID();var e=this.version===b("PhotosConst").VIEWER_PERMALINK?b("FaceboxSourceConstants").PERMALINK_DISMISS:b("FaceboxSourceConstants").SNOWLIFT_DISMISS;this.dismissFaceboxSuggestion(a.id.replace("face:",""),c.getAttribute("data-id"),this.photoData.owner,e);this.removeSuggestionFromTagger();this.hideTagger();b("DOM").remove(this.getFaceboxSuggestionFromFaceboxElem(a.node));b("Arbiter").inform("PhotoTagger.TAG_SUGGESTION_REJECTED/"+d)}.bind(this)),b("Event").listen(e,"click",function(a){a=this._getCurrentFaceboxID();var d={uid:c.getAttribute("data-id"),text:c.getAttribute("data-text")};d=this.tokenizer.createToken(d);var e=this.version===b("PhotosConst").VIEWER_PERMALINK?b("FaceboxSourceConstants").PERMALINK_SUGGEST:b("FaceboxSourceConstants").SNOWLIFT_SUGGEST;this.saveTag(null,d,e);b("Arbiter").inform("PhotoTagger.TAG_SUGGESTION_CONFIRMED/"+a)}.bind(this)))};c._getCurrentFaceboxID=function(){return this.currentFacebox&&this.currentFacebox.id.substring(5)};a.getInstance=function(b){return a.instances[b]};a.resetAlbumTaggingSuggestions=function(b){b=a.getInstance(b);b&&b.resetAlbumTaggingSuggestions()};return a}();Object.assign(a,{instances:{}});e.exports=a}),null);
__d("PhotoTags",["csx","Arbiter","CSS","DOM","Event","Parent","PhotosConst","ge"],(function(a,b,c,d,e,f,g){a=function(){"use strict";function a(a,c,d){var e=this;this.tagTargets=a;this.tagBox=c;this.version=d||b("PhotosConst").VIEWER_PERMALINK;this.handlers=[];this.tagTargets.forEach(function(a){e.handlers.push(b("Event").listen(a,{mouseover:e.showTag.bind(e),mouseout:e.hideTags.bind(e)}))});this.subscriptions=[];this.version==b("PhotosConst").VIEWER_SNOWLIFT&&this.subscriptions.push(b("Arbiter").subscribe("PhotoSnowlift.PAGE",this.hideTags.bind(this)))}var c=a.prototype;c.showTag=function(a){a=a.getTarget();var c=b("CSS").hasClass(a,"taggee"),d=b("CSS").matchesSelector(a,"._54ru"),e=null,f=null;if(c)e=a.getAttribute("data-tag"),f=a.getAttribute("data-tagtype");else if(d){c=b("Parent").byTag(a,"a");e=c&&c.getAttribute("data-tag")}e||(a=b("Parent").byClass(a,"taggee"),a&&(e=a.getAttribute("data-tag"),f=a.getAttribute("data-tagtype")));d=this.version==b("PhotosConst").VIEWER_PERMALINK?"perm:tag:"+e:"tag:"+e;c=d&&b("ge")(d);c&&(f==="product"?b("CSS").addClass(c,"hover"):b("CSS").addClass(c,"showTag"),b("CSS").addClass(this.tagBox,"showingTag"),b("Arbiter").inform("PhotoTags.SHOWTAG",e))};c.hideTags=function(){b("CSS").removeClass(this.tagBox,"showingTag"),b("DOM").scry(this.tagBox,"div.showTag").forEach(function(a){b("CSS").removeClass(a,"showTag")}),b("DOM").scry(this.tagBox,"div.hover").forEach(function(a){b("CSS").removeClass(a,"hover")}),b("Arbiter").inform("PhotoTags.HIDETAG")};c.destroy=function(){for(var a in this.handlers)this.handlers[a].remove();this.subscriptions.forEach(b("Arbiter").unsubscribe,b("Arbiter"))};return a}();e.exports=a}),null);
__d("PhotoViewerFollow",["$","Arbiter","AsyncRequest","CSS","DOM","Event","ODS","Parent","PhotosConst","collectDataAttributes"],(function(a,b,c,d,e,f){var g={};a=function(){"use strict";function a(a){this.FOLLOW_LOCATION_PHOTO=48,this.viewer=a}var c=a.prototype;c.init=function(a,c,d,e,f,g,h){this.subscribeLink=a,this.unsubscribeFlyout=c,this.subscribeEndpoints=f,this.unsubscribeEndpoints=g,this.unsubLinks=e,this.unsubDiv=d,this.reset(),this.activate(),this.type=h,b("Event").listen(this.subscribeLink,"click",function(a){b("Parent").byClass(a.getTarget(),"photoViewerFollowLink")&&this.subscribePhotoOwner()}.bind(this)),b("Event").listen(this.unsubLinks.user,"click",this.unsubscribePhotoOwner.bind(this)),b("Event").listen(this.unsubLinks.page,"click",this.unsubscribePhotoOwner.bind(this)),b("Arbiter").subscribe(["FollowUser","FollowUserFail","UnfollowUser","UnfollowUserFail"],this.updateSubscribe.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("DATA_CHANGE"),this.showSubscribeLinkOnChange.bind(this)),this.viewer.getVersionConst()===b("PhotosConst").VIEWER_SNOWLIFT&&(b("Arbiter").subscribe(this.viewer.getEventString("CLOSE"),this.reset.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("OPEN"),this.activate.bind(this))),this.registerUnsubscribeTarget()};c.activate=function(){this.activated=!0};c.reset=function(){this.unsubscribeFlyout&&this.unsubscribeFlyout.clearNodes(),this.subscriptionChange={},this.activated=!1};c.registerUnsubscribeTarget=function(){if(!this.unsubscribeFlyout)return;var a=b("DOM").scry(this.subscribeLink,".photoViewerFollowedMsg")[0];a&&!b("CSS").hasClass(a,"unsubFlyoutEnabled")&&(this.unsubscribeFlyout.initNode(a),b("CSS").addClass(a,"unsubFlyoutEnabled"))};c.updateSubscribe=function(a,b){if(!this.activated)return;b=b.profile_id;b&&(this.subscriptionChange[b]=a==="FollowUser"||a==="UnfollowUserFail"?"following":"unfollowed",this.toggleSubscribeLink(b))};c.showSubscribeLinkOnChange=function(a,c){this.type=c.ownertype,b("CSS").conditionClass(this.unsubDiv,"isPage",this.type==="page"),this.toggleSubscribeLink(c.owner)};c.toggleSubscribeLink=function(a){var c=b("DOM").scry(this.subscribeLink,"span.fbPhotoSubscribeWrapper")[0];if(!c)return;this.subscriptionChange[a]&&(b("CSS").conditionClass(c,"followingOwner",this.subscriptionChange[a]==="following"),this.subscriptionChange[a]==="unfollowed"&&(this.unsubscribeFlyout&&this.unsubscribeFlyout.hideFlyout(!0)));this.registerUnsubscribeTarget()};c.subscribePhotoOwner=function(){if(!this.viewer.getOwnerId())return;var a=this.type==="user"?{profile_id:this.viewer.getOwnerId()}:{fbpage_id:this.viewer.getOwnerId(),add:!0,reload:!1,fan_origin:"photo_snowlift"};b("Arbiter").inform("FollowUser",{profile_id:this.viewer.getOwnerId()});this.type==="page"&&b("ODS").bumpEntityKey(2966,"snowlift_page_like","snowlift_page_like.clicked_link");a.location=this.FOLLOW_LOCATION_PHOTO;var c=event.getTarget();c&&Object.assign(a,{ft:b("collectDataAttributes")(c,["ft"]).ft});new(b("AsyncRequest"))(this.subscribeEndpoints[this.type]).setAllowCrossPageTransition(!0).setData(a).setMethod("POST").setReadOnly(!1).setErrorHandler(b("Arbiter").inform.bind(null,"FollowUserFail",a)).send()};c.unsubscribePhotoOwner=function(){if(!this.viewer.getOwnerId())return;var a=this.type==="user"?{profile_id:this.viewer.getOwnerId()}:{fbpage_id:this.viewer.getOwnerId(),add:!1,reload:!1};b("Arbiter").inform("UnfollowUser",{profile_id:this.viewer.getOwnerId()});a.location=this.FOLLOW_LOCATION_PHOTO;var c=event.getTarget();c&&Object.assign(a,{ft:b("collectDataAttributes")(c,["ft"]).ft});new(b("AsyncRequest"))(this.unsubscribeEndpoints[this.type]).setAllowCrossPageTransition(!0).setData(a).setMethod("POST").setReadOnly(!1).setErrorHandler(b("Arbiter").inform.bind(null,"UnfollowUserFail",a)).send()};a.createInstance=function(c,d,e,f,h,i,j,k){c=c.getInstance();var l=new a(c);l.init(b("$")(d),e,f,h,i,j,k);g[c.getVersionConst()]=l;return l};a.getInstance=function(a){return g[a]};return a}();e.exports=a}),null);
__d("PhotoViewerInitPagelet",["DOM","PhotoSnowlift","PhotoTagApproval","PhotoTagger","PhotoTags","ge"],(function(a,b,c,d,e,f){a=function(a){"use strict";b("PhotoSnowlift").attachTagger(a.tagging,a.tokenizer,a.ufi);var c=b("PhotoSnowlift").getInstance(),d=c.getRoot();new(b("PhotoTags"))([b("ge")("fbPhotoSnowliftAuthorName"),b("DOM").find(d,"span.fbPhotoTagList")],b("ge")("fbPhotoSnowliftTagBoxes"),a.version);if(a.setupPhotoTagger){d=new(b("PhotoTagger"))(c);d.initSnowlift(a.tagging,a.tokenizer,a.userId,a.ufi);d.setQueueName(a.queueName)}new(b("PhotoTagApproval"))(c)};e.exports=a}),null);
__d("TagToken",["DOM","Token"],(function(a,b,c,d,e,f){a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b){return a.call(this,b,"tag")||this}var d=c.prototype;d.createElement=function(){var a=this.isFreeform(),c=b("DOM").create("span",{className:"separator"},", "),d=b("DOM").create(a?"span":"a",{className:"taggee","data-tag":this.getValue()},this.getText());a||(d.href=this.getInfo().path);return b("DOM").create("span",{className:"tagItem"},[c,d])};return c}(b("Token"));e.exports=a}),null);
__d("TagTokenizer",["fbt","Arbiter","CSS","DOM","Parent","TagToken","Tokenizer","createObjectFrom","ge","getElementText"],(function(a,b,c,d,e,f,g){a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c,d,e,f,g){e=a.call(this,e,f,g)||this;b("Arbiter").subscribe("PhotoInlineEditor.CANCEL_INLINE_EDITING",e.updateTokenareaVisibility.bind(babelHelpers.assertThisInitialized(e)),"new");e.appphoto=d;b("Arbiter").subscribe(c.getInstance().getEventString("DATA_CHANGE"),e.setup.bind(babelHelpers.assertThisInitialized(e)),"new");return e}var d=c.prototype;d.setup=function(a,b){this.appphoto=b.byapp;this.byowner=b.isowner;return this.reset()};d.reset=function(){var c=this,d=this.getTokenElements().map(this.getTokenDataFromTag,this);this.withTagKeys={};var e=this.getWithTagTokenElements().map(function(a){return c._tokenKey(c.getTokenDataFromTag(a))});this.withTagKeys=b("createObjectFrom")(e);return a.prototype.reset.call(this,d)};d.processEvents=function(a,c,d){if(b("Parent").byClass(c,"remove")){d=this.getTokenFromElement(d);d=this.addTokenData(d,c);this.removeToken(d);a.kill()}};d.insertToken=function(a){return null};d.removeToken=function(a){if(this.appphoto)return this.replaceToken(a);else this.inform("removeToken",a),b("Arbiter").inform("Form/change",{node:this.element});return null};d.addTokenData=function(a,c){b("Parent").byClass(c,"blockuser")&&(a.blockUser=!0);return a};d.getTokenDataFromTag=function(a){return{uid:b("DOM").find(a,"input").value,text:b("getElementText")(b("DOM").find(a,".taggee"))}};d.getTokenElementFromTarget=function(a){return b("Parent").byClass(a,"tagItem")};d.getTokenElements=function(){return b("DOM").scry(this.tokenarea,"span.tagItem").filter(this.filterNonTokenElements,this)};d.getWithTagTokenElements=function(){return b("DOM").scry(this.tokenarea,"span.withTagItem")};d.filterNonTokenElements=function(a){return!b("CSS").hasClass(a,"markasspam")&&!b("CSS").hasClass(a,"reported")&&!b("CSS").hasClass(a,"withTagItem")};d.createToken=function(a,c){var d=this.getToken(this._tokenKey(a));d=d||new(b("TagToken"))(a);c&&d.setElement(c);return d};d.updateTokenareaVisibility=function(){var a=this.getTokenElements().filter(function(a){return b("CSS").shown(a)}),c=this.getWithTagTokenElements(),d=b("DOM").scry(this.tokenarea,"span.ogTagItem");b("CSS").conditionShow(this.tokenarea,a.length!==0||c.length!==0||d.length!==0)};d.replaceToken=function(a){if(!a)return;var c=this.tokens.indexOf(a);if(c<0)return;this.tokens.splice(this.tokens.indexOf(a),1);delete this.unique[this._tokenKey(a.getInfo())];c=b("ge")("tagspam"+a.getValue());c&&b("DOM").remove(c);c=[" [",g._("Kitambulisho Kiliondolewa")," "];c.push(b("DOM").create("a",{onclick:this.markAsSpam.bind(this,a.getValue())},g._("Mark tag as spam")));c.push("] ");c=b("DOM").create("span",{className:"fbPhotosTaglistTag tagItem markasspam",id:"tagspam"+a.getValue()},c);b("DOM").replace(a.getElement(),c);this.updateTokenarea();this.inform("removeToken",a);b("Arbiter").inform("Form/change",{node:this.element})};d.markAsSpam=function(a){var c=b("ge")("tagspam"+a),d=[" [",g._("Tag Reported"),"] "];d=b("DOM").create("span",{className:"fbPhotosTaglistTag tagItem reported",id:"tagspam"+a},d);b("DOM").replace(c,d);this.inform("markTagAsSpam",a)};d.removeTokenForSpatialTag=function(b){a.prototype.removeToken.call(this,b)};return c}(b("Tokenizer"));e.exports=a}),null);
__d("TagTypeaheadView",["AsyncRequest","CSS","ContextualTypeaheadView","DOM","FamilyTaggingConfig","Parent"],(function(a,b,c,d,e,f){a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b,c){b=a.call(this,b,c)||this;b.hintText=c.hintText;b.userEd=c.userEd;b.origAutoSelect=c.autoSelect;b.setSuggestions(c.suggestions);return b}var d=c.prototype;d.init=function(){b("CSS").addClass(this.element,"uiTagTypeaheadView"),a.prototype.init.call(this)};d.buildResults=function(c){this.hasResultsWithEmptyInput=!1;(!this.value||this.hasResultsWithEmptyInput)&&this.hintText&&c.unshift({subtext:this.hintText,type:"hintText"});this.userEd&&(new(b("AsyncRequest"))().setURI("/ajax/fof/user_education.php").setData({increment:1}).send(),c.unshift({subtext:this.userEd,type:"userEdText"}));if(b("FamilyTaggingConfig").gk){var d=[],e=[];for(var f=0;f<c.length;f++)c[f].type!=="family_tags"&&c[f].index!=-1e3&&c[f].type!=="hintText"?d.push(c[f]):e.push(c[f]);c=e.concat(d);a.prototype.updateResults.call(this,c)}f=a.prototype.buildResults.call(this,c);this.userEd&&c.shift();(!this.value||this.hasResultsWithEmptyInput)&&c.shift();return f};d.show=function(){var c=b("DOM").scry(this.context,".typeaheadBackdrop");c.length>0&&b("CSS").addClass(c[0],"resultsPresent");return a.prototype.show.call(this)};d.hide=function(){var c=b("DOM").scry(this.context,".typeaheadBackdrop");c.length>0&&b("CSS").removeClass(c[0],"resultsPresent");return a.prototype.hide.call(this)};d.render=function(b,c,d){this.autoSelect=this.origAutoSelect&&b.length,this.disableAutoSelect=b.length===0,c=c.concat(this.getAdditionalResults()),a.prototype.render.call(this,b,c,d)};d.getItems=function(){var b=a.prototype.getItems.call(this);(!this.value||this.hasResultsWithEmptyInput)&&b.shift();this.userEd&&b.shift();return b};d.getSuggestions=function(){return this.suggestions};d.setSuggestions=function(a){this.suggestions=a?a.map(String):[],this.visible=!!this.suggestions.length};d.addSuggestion=function(a){this.suggestions.unshift(a)};d.addTypeaheadFlip=function(a){b("CSS").addClass(this.element,a)};d.removeTypeaheadFlip=function(a){b("CSS").removeClass(this.element,a)};d.getContext=function(){var c=b("Parent").byClass(this.element,"typeaheadContainer");if(c)return c;else return a.prototype.getContext.call(this)};d.getAdditionalResults=function(){return[]};return c}(b("ContextualTypeaheadView"));e.exports=a}),null);
__d("FreeformTokenizerBehavior",["Event","Input","Keys"],(function(a,b,c,d,e,f){function a(a,c){var d=c.matcher&&new RegExp(c.matcher,"i"),e=c.splitter&&new RegExp(c.splitter),f=c.tokenize_on_blur!==!1,g=c.tokenize_on_paste!==!1,h=c.split_on_check===!0,i=c.select_on_comma!==!1,j=c.select_on_space===!0,k=c.never_submit===!0;function l(c){var f=b("Input").getValue(a.getInput()).trim();e&&c&&c.type=="paste"?f=f.split(e):e&&h?f=f.split(e):f=[f];var g=!1;for(var i=0;i<f.length;i++){var j=f[i].trim();if(j&&(!d||d.test(j))){j={uid:j,text:j,freeform:!0};a.addToken(a.createToken(j));g=!0}}c&&g&&(a.getTypeahead().getCore().afterSelect(),c.kill())}a.subscribe("keydown",function(c,d){c=d.event;d=b("Event").getKeyCode(c);if(d==b("Keys").RETURN||i&&d==b("Keys").COMMA||j&&d==b("Keys").SPACE){var e=a.getTypeahead().getView();e.getSelection()?(e.select(),c.kill()):l(c)}d==b("Keys").RETURN&&k&&c.kill()});a.subscribe("paste",function(a,b){g&&setTimeout(l.bind(null,b.event),20)});a.subscribe("blur",function(b,c){f&&l(),a.getTypeahead().getCore().reset()})}e.exports=a}),null);